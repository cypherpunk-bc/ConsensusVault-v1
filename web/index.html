<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ConsensusVault - DApp</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile.css" media="(max-width: 960px)">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div id="app">
        <!-- 顶部导航 -->
        <header class="nav">
            <div class="nav-left">
                <div class="logo">
                    <span class="logo-mark">◎</span>
                    <span class="logo-text">ConsensusVault</span>
                    <span class="logo-badge">v1</span>
                </div>
                <nav class="nav-tabs">
                    <a class="tab active" data-view="explore">
                        <i class="fas fa-compass"></i> 探索
                    </a>
                    <a class="tab" data-view="vaults">
                        <i class="fas fa-vault"></i> 我的金库
                    </a>
                </nav>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="搜索金库或代币地址...">
                    <button id="searchBtn" class="btn ghost">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            <div class="nav-right">
                <div class="chain-info" id="networkInfo">
                    <i class="fas fa-network-wired"></i>
                    <select id="networkSelect" class="network-select">
                        <option value="mainnet">BSC 主网</option>
                        <option value="testnet">BSC 测试网</option>
                    </select>
                </div>
                <button id="connectButton" class="btn primary">
                    <i class="fas fa-wallet"></i>
                    连接钱包
                </button>
            </div>
        </header>

        <!-- 视图容器 -->
        <div class="views-container">
            <!-- 视图：探索 -->
            <main id="view-explore" class="view active">
                <div class="container">
                    <!-- 创建新金库 -->
                    <section class="section create-section">
                        <h2 class="section-title">
                            <i class="fas fa-plus-circle"></i>
                            创建新金库
                        </h2>
                        <div class="form-group">
                            <label>金库名称（可选）</label>
                            <input type="text" id="createVaultNameInput" placeholder="输入自定义金库名称" class="input-large" maxlength="50">
                            <small>为金库起一个易记的名称（最多50个字符），留空则使用代币符号。在卡片中显示时超过30个字符会自动截断。</small>
                        </div>
                        <div class="form-group">
                            <label>代币合约地址</label>
                            <input type="text" id="createTokenInput" placeholder="0x..." class="input-large">
                            <small>为任何 ERC20 代币创建共识金库，系统将自动读取代币符号</small>
                        </div>
                        <div class="form-group">
                            <label>初始存款数量</label>
                            <input type="number" id="createDepositInput" placeholder="输入存款数量" class="input-large"
                                min="0.01" step="0.01">
                            <small>创建金库时必须存入的代币数量（必填，必须 > 0）</small>
                        </div>
                        <div id="pluginOptionsSection" class="form-group" style="display: none;">
                            <div id="pluginSummaryLine" class="plugin-summary-line">
                                与经典金库相同规则。<button type="button" id="pluginToggleBtn" class="btn-link">高级：选择插件</button> <span id="pluginToggleIcon">▼</span>
                            </div>
                            <div id="pluginExpandable" class="form-group" style="display: none; margin-top: 0.75rem;">
                                <div id="pluginPassRatioRow" class="form-group" style="margin-bottom: 0.5rem; display: none;">
                                    <label class="label-small">通过率（%）</label>
                                    <input type="number" id="pluginPassRatioPct" class="input-large" placeholder="50" min="0" max="100" step="1" title="选择共识策略后可填：0%=不投票即通过（发红包等），1–100%=赞成票占比达到即达成共识，不填默认 50%">
                                </div>
                                <div class="plugin-row">
                                    <div class="form-group" style="margin-bottom: 0.5rem;">
                                        <label class="label-small">捐赠策略</label>
                                        <select id="pluginDonatePolicy" class="input-large">
                                            <option value="">不选（与经典金库相同）</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0.5rem;">
                                        <label class="label-small">分红分配</label>
                                        <select id="pluginRewardDistributor" class="input-large">
                                            <option value="">不选（与经典金库相同）</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0.5rem;">
                                        <label class="label-small">共识策略</label>
                                        <select id="pluginConsensusPolicy" class="input-large">
                                            <option value="">不选（与经典金库相同）</option>
                                        </select>
                                    </div>
                                </div>
                                <small>
                                    不选共识策略 = 与经典金库相同（通过率 50%）。<strong>选择共识策略后</strong>，可填写上面「通过率」：0%=不投票即通过（如发红包），1–100%=赞成票占比达到即达成共识。捐赠/分红插件可选。
                                </small>
                            </div>
                        </div>
                        <button id="createVaultBtn" class="btn btn-primary btn-large">
                            <i class="fas fa-hammer"></i> 创建金库并存款
                        </button>
                    </section>

                    <!-- 所有金库列表 -->
                    <section class="section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-list"></i>
                                所有金库
                            </h2>
                            <div class="sort-controls">
                                <label>排序方式：</label>
                                <select id="sortSelect" class="select-sort">
                                    <option value="newest">最新创建</option>
                                    <option value="progress">共识进度最高</option>
                                    <option value="marketValue">总市值最高</option>
                                    <option value="participantCount">参与人数最多</option>
                                    <option value="donations">获得的捐赠最多</option>
                                </select>
                            </div>
                        </div>
                        <div id="vaultsGrid" class="vaults-grid">
                            <div class="loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                加载金库列表...
                            </div>
                        </div>
                        <div id="loadingMore" class="loading-more" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                            加载更多...
                        </div>
                    </section>
                </div>
            </main>

            <!-- 视图：我的金库 -->
            <main id="view-vaults" class="view">
                <div class="container">
                    <section class="section">
                        <h2 class="section-title">
                            <i class="fas fa-user"></i>
                            我的金库
                        </h2>

                        <div id="userVaultsGrid" class="vaults-grid">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>未参与任何金库</p>
                                <p class="text-muted">连接钱包或在"探索"中创建/参与金库</p>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>

        <!-- 页脚 -->
        <footer class="footer">
            <div class="footer-links">
                <a href="https://github.com/cypherpunk-bc/ConsensusVault-v1" target="_blank" rel="noopener noreferrer"><i class="fas fa-book"></i> 文档</a>
                <a href="https://github.com/cypherpunk-bc/ConsensusVault-v1" target="_blank" rel="noopener noreferrer"><i class="fab fa-github"></i> GitHub</a>
                <a href="https://x.com/Consensus_Vault" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter"></i> Twitter</a>
            </div>
            <div class="footer-warning">
                <i class="fas fa-exclamation-triangle"></i>
                风险提示：请勿投入超过承受范围的资金
            </div>
        </footer>
    </div>

    <!-- 加载动画 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <i class="fas fa-spinner fa-spin"></i>
            <p id="loadingText">处理中...</p>
        </div>
    </div>

    <!-- 通用模态框 -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"></h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="index.js"></script>
</body>

</html>